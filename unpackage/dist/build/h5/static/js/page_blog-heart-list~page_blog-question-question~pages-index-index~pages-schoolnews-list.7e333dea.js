(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page_blog-heart-list~page_blog-question-question~pages-index-index~pages-schoolnews-list"],{"3a12":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={uniDateformat:i("8d7b").default,uActionSheet:i("3f22").default},a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"blogitem"},[i("v-uni-view",{staticClass:"head"},[i("v-uni-view",{staticClass:"userinfo"},[i("v-uni-view",{staticClass:"avatar"},[i("v-uni-image",{attrs:{src:e.giveAvatar(e.item),mode:"aspectFill"}})],1),i("v-uni-view",{staticClass:"name"},[e._v(e._s(e.giveName(e.item)))]),i("v-uni-view",{staticClass:"time"},[i("uni-dateformat",{attrs:{date:e.item.publish_date,format:"MM月dd hh:mm",threshold:[6e4,2592e6]}})],1)],1),i("v-uni-view",{staticClass:"more",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clickMore.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-ellipsis"})],1)],1),i("v-uni-view",{staticClass:"body"},[i("v-uni-view",{staticClass:"title",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goDetail.apply(void 0,arguments)}}},[e._v(e._s(e.item.title))]),e.item.description?i("v-uni-view",{staticClass:"text",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goDetail.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"t"},[e._v(e._s(e.item.description))])],1):e._e(),e.item.picurls.length?i("v-uni-view",{staticClass:"piclist"},e._l(e.item.picurls,(function(t,n){return i("v-uni-view",{key:t,staticClass:"pic",class:1==e.item.picurls.length?"only":""},[i("v-uni-image",{attrs:{src:t,mode:"aspectFill"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clickPic(n)}}})],1)})),1):e._e()],1),i("v-uni-view",{staticClass:"info"},[i("v-uni-view",{staticClass:"box"},[i("v-uni-text",{staticClass:"iconfont icon-a-27-liulan"}),i("v-uni-text",[e._v(e._s(e.item.view_count))])],1),i("v-uni-view",{staticClass:"box",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goDetail.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-a-5-xinxi"}),i("v-uni-text",[e._v(e._s(e.item.comment_count&&e.item.comment_count>0?e.item.comment_count:"评论"))])],1),i("v-uni-view",{staticClass:"box",class:e.item.isLike?"active":" ",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clickLike.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-a-106-xihuan"}),i("v-uni-text",[e._v(e._s(e.item.like_count?e.item.like_count:"点赞"))])],1)],1),i("u-action-sheet",{attrs:{actions:e.list,cancelText:"取消",show:e.sheetShow,closeOnClickOverlay:!0,closeOnClickAction:!0},on:{select:function(t){arguments[0]=t=e.$handleEvent(t),e.sheetSelect.apply(void 0,arguments)},close:function(t){arguments[0]=t=e.$handleEvent(t),e.onClouse.apply(void 0,arguments)}}})],1)},o=[]},"3a3c":function(e,t,i){"use strict";(function(e){i("7a82");var n=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.store=t.mutations=void 0;var a=n(i("c7eb")),o=n(i("1da1"));i("b64b"),i("d3b7"),i("159b");var r=n(i("bab5")),s=n(i("e143")),u=e.importObject("uni-id-co"),c=e.database(),l=c.collection("uni-id-users"),d=uni.getStorageSync("uni-id-pages-userInfo")||{};console.log(d);var f=e.getCurrentUserInfo().tokenExpired-Date.now();f<=0&&(d={});var v={userInfo:d,hasLogin:0!=Object.keys(d).length&&f>0};console.log("data",v);var h={updateUserInfo:function(){var e=arguments,t=this;return(0,o.default)((0,a.default)().mark((function i(){var n,o;return(0,a.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],!n){i.next=5;break}l.where("_id==$env.uid").update(n).then((function(e){console.log(e),e.result.updated?(uni.showToast({title:"更新成功",icon:"none"}),t.setUserInfo(n)):uni.showToast({title:"没有改变",icon:"none"})})),i.next=17;break;case 5:return i.prev=5,i.next=8,l.where("'_id' == $cloudEnv_uid").field("mobile,nickname,username,email,avatar_file,register_date").get();case 8:o=i.sent,console.log("fromDbData",o.result.data),t.setUserInfo(o.result.data[0]),i.next=17;break;case 13:i.prev=13,i.t0=i["catch"](5),t.setUserInfo({},{cover:!0}),console.error(i.t0.message,i.t0.errCode);case 17:case"end":return i.stop()}}),i,null,[[5,13]])})))()},setUserInfo:function(e){var t=arguments;return(0,o.default)((0,a.default)().mark((function i(){var n,o,r;return(0,a.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{cover:!1},o=n.cover,console.log("set-userInfo",e),r=o?e:Object.assign(m.userInfo,e),m.userInfo=Object.assign({},r),m.hasLogin=0!=Object.keys(m.userInfo).length,console.log("store.userInfo",m.userInfo),uni.setStorage({key:"uni-id-pages-userInfo",data:m.userInfo}),i.abrupt("return",e);case 8:case"end":return i.stop()}}),i)})))()},logout:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u.logout();case 2:uni.removeStorageSync("uni_id_token"),uni.setStorageSync("uni_id_token_expired",0),uni.redirectTo({url:"/pages/self/self"}),uni.$emit("uni-id-pages-logout"),e.setUserInfo({},{cover:!0});case 7:case"end":return t.stop()}}),t)})))()},loginSuccess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.showToast,i=void 0===t||t,n=e.toastText,a=void 0===n?"登录成功":n,o=e.autoBack,s=void 0===o||o,u=e.uniIdRedirectUrl,c=void 0===u?"":u;if(console.log({toastText:a,autoBack:s}),i&&uni.showToast({title:a,icon:"none"}),this.updateUserInfo(),uni.$emit("uni-id-pages-login-success"),s){var l=0,d=getCurrentPages();if(d.forEach((function(e,t){"login"==d[d.length-t-1].route.split("/")[3]&&l++})),c)return uni.reLaunch({url:c});if("weixin"==e.loginType)return console.log("window.history",window.history),window.history.go(-3);if(l){var f=r.default.pages[0];return uni.reLaunch({url:"/".concat(f.path)})}uni.navigateBack({delta:l})}}};t.mutations=h;var m=s.default.observable(v);t.store=m}).call(this,i("a9ff")["default"])},"3dba":function(e,t,i){"use strict";i.r(t);var n=i("fd52"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"4c13":function(e,t,i){"use strict";i.r(t);var n=i("aa5b"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},6115:function(e,t,i){"use strict";(function(e){i("7a82");var n=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.getImgSrc=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=[];return e.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/g,(function(e,t){i.push(t)})),i=i.slice(0,t),i},t.getProvince=function(){return new Promise((function(e,t){var i=uni.getStorageSync("historyProvince");i?Date.now()-i.time>36e5?r().then((function(t){e(t)})).catch((function(e){t(e)})):e(i.province):r().then((function(t){e(t)})).catch((function(e){t(e)}))}))},t.giveAvatar=function(e){var t,i,n;return null!==(t=null===(i=e.user_id[0])||void 0===i||null===(n=i.avatar_file)||void 0===n?void 0:n.url)&&void 0!==t?t:"../../static/images/user-default.jpg"},t.giveName=function(e){return e.user_id[0].nickname||e.user_id[0].username||e.user_id[0].mobile||"请设置昵称"},t.likeFun=function(e){return c.apply(this,arguments)};var a=n(i("c7eb")),o=n(i("1da1"));function r(){return new Promise((function(e,t){uni.request({url:"https://restapi.amap.com/v3/ip?key=85afc39de405884a4ca38ca8941d895b",success:function(t){var i="";i="string"==typeof t.data.province?t.data.province:"火星",e(i);var n={province:i,time:Date.now()};uni.setStorageSync("historyProvince",n)},fail:function(e){t(e)}})}))}i("ac1f"),i("5319"),i("14d9"),i("fb6a"),i("d3b7");var s=e.database(),u=e.importObject("utilsObj",{customUI:!0});function c(){return c=(0,o.default)((0,a.default)().mark((function e(t){var i;return(0,a.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.collection("quanzi_like").where('article_id=="'.concat(t,'" && user_id==$cloudEnv_uid')).count();case 2:i=e.sent,i.result.total?(s.collection("quanzi_like").where('article_id=="'.concat(t,'" && user_id==$cloudEnv_uid')).remove(),u.operation("quanzi_article","like_count",t,-1)):(s.collection("quanzi_like").add({article_id:t}),u.operation("quanzi_article","like_count",t,1));case 4:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}}).call(this,i("a9ff")["default"])},"849e":function(e,t,i){"use strict";i.r(t);var n=i("3a12"),a=i("4c13");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("bd16");var r=i("f0c5"),s=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"859e7634",null,!1,n["a"],void 0);t["default"]=s.exports},"8d7b":function(e,t,i){"use strict";i.r(t);var n=i("b984"),a=i("3dba");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);var r=i("f0c5"),s=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"690ab064",null,!1,n["a"],void 0);t["default"]=s.exports},aa5b:function(e,t,i){"use strict";(function(e){i("7a82");var n=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("a9e3"),i("d3b7"),i("159b");var a=n(i("bab5")),o=i("3a3c"),r=i("6115"),s=e.database(),u={name:"blog-item",props:{item:{type:Object,default:function(){return{}}},isLike:Boolean,like_count:Number},data:function(){return{sheetShow:!1,list:[{name:"修改",type:"edit",disabled:!0},{name:"删除",type:"del",color:"#F56C6C",disabled:!0}]}},methods:{giveName:r.giveName,giveAvatar:r.giveAvatar,clickLike:function(){if(o.store.hasLogin){var e=Date.now();if(e-this.likeTime<2e3)uni.showToast({title:"操作太频繁，请稍后...",icon:"none"});else{this.likeTime=e;var t=this.item.like_count;this.item.isLike?t--:t++;var i=!this.item.isLike;this.$emit("update:isLike",i),this.$emit("update:like_count",t),(0,r.likeFun)(this.item._id)}}else uni.showModal({title:"登录后才可以进行操作",success:function(e){e.confirm&&uni.navigateTo({url:"/"+a.default.uniIdRouter.loginPage})}})},clickMore:function(){var t=e.getCurrentUserInfo().uid;(t==this.item.user_id[0]._id||this.uniIDHasRole("admin")||this.uniIDHasRole("webadmin"))&&this.list.forEach((function(e){e.disabled=!1})),this.sheetShow=!0},sheetSelect:function(e){this.sheetShow=!1;var t=e.type;console.log(t),"del"==t&&this.delFun(),"edit"==t&&this.editFun()},editFun:function(){uni.navigateTo({url:"/pages/quanzi_article/edit?id="+this.item._id})},delFun:function(){var e=this;uni.showLoading({title:"加载中..."}),s.collection("quanzi_article").doc(this.item._id).update({delState:!0}).then((function(t){uni.hideLoading(),uni.showToast({title:"删除成功",icon:"none"}),e.$emit("delEvent",!0)})).catch((function(e){uni.hideLoading()}))},onClouse:function(){this.sheetShow=!1},goDetail:function(){uni.navigateTo({url:"/pages/quanzi_article/detail?id="+this.item._id})},clickPic:function(e){uni.previewImage({urls:this.item.picurls,current:e})}}};t.default=u}).call(this,i("a9ff")["default"])},b984:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this.$createElement,t=this._self._c||e;return t("v-uni-text",[this._v(this._s(this.dateShow))])},a=[]},bd16:function(e,t,i){"use strict";var n=i("bdd0"),a=i.n(n);a.a},bdd0:function(e,t,i){var n=i("d2bf");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=i("4f06").default;a("60228e88",n,!0,{sourceMap:!1,shadowMode:!1})},d2bf:function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.blogitem .head[data-v-859e7634]{display:flex;font-size:%?32?%;align-items:center;justify-content:space-between}.blogitem .head .userinfo[data-v-859e7634]{display:flex;align-items:center}.blogitem .head .userinfo .avatar[data-v-859e7634]{width:%?40?%;height:%?40?%;border-radius:50%;border-radius:50%;overflow:hidden}.blogitem .head .userinfo .avatar uni-image[data-v-859e7634]{width:100%;height:100%;display:block}.blogitem .head .userinfo .name[data-v-859e7634]{color:#222;padding-left:%?10?%}.blogitem .head .userinfo .time[data-v-859e7634]{color:#888;font-size:%?22?%;padding-left:%?20?%}.blogitem .head .more[data-v-859e7634]{padding:%?5?%}.blogitem .head .more .iconfont[data-v-859e7634]{font-size:%?50?%;color:#888}.blogitem .body[data-v-859e7634]{padding:%?15?% 0 %?30?%}.blogitem .body .title[data-v-859e7634]{font-size:%?44?%;color:#000;font-weight:600;text-align:justify;text-overflow:-o-ellipsis-lastline;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.blogitem .body .text[data-v-859e7634]{padding-top:%?10?%;padding-bottom:%?10?%;font-size:%?30?%;text-align:justify;color:#888}.blogitem .body .text .t[data-v-859e7634]{text-overflow:-o-ellipsis-lastline;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.blogitem .body .piclist[data-v-859e7634]{display:flex;padding-top:%?20?%}.blogitem .body .piclist .pic[data-v-859e7634]{width:%?225?%;height:%?225?%;margin-right:%?6?%;overflow:hidden}.blogitem .body .piclist .pic uni-image[data-v-859e7634]{width:100%;height:100%}.blogitem .body .piclist .pic[data-v-859e7634]:first-child{border-radius:%?20?% 0 0 %?20?%}.blogitem .body .piclist .pic[data-v-859e7634]:last-child{border-radius:0 %?20?% %?20?% 0}.blogitem .body .piclist .pic.only[data-v-859e7634]{border-radius:%?20?%}.blogitem .info[data-v-859e7634]{display:flex;align-items:center;justify-content:space-around;font-size:%?26?%;color:#333}.blogitem .info .box[data-v-859e7634]{display:flex;align-items:center;padding:%?15?% 0 %?5?%;flex:1;display:flex;justify-content:center}.blogitem .info .box .iconfont[data-v-859e7634]{font-size:%?40?%;padding-right:%?10?%}.blogitem .info .box.active[data-v-859e7634]{color:#0199fe}',""]),e.exports=t},d6ef:function(e,t,i){"use strict";i("7a82");var n=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=u,t.friendlyDate=function(e,t){var i=t.locale,n=void 0===i?"zh":i,a=t.threshold,o=void 0===a?[6e4,36e5]:a,r=t.format,c=void 0===r?"yyyy/MM/dd hh:mm:ss":r;if("-"===e)return e;if(!e&&0!==e)return"";var l,d,f={zh:{year:"年",month:"月",day:"天",hour:"小时",minute:"分钟",second:"秒",ago:"前",later:"后",justNow:"刚刚",soon:"马上",template:"{num}{unit}{suffix}"},en:{year:"year",month:"month",day:"day",hour:"hour",minute:"minute",second:"second",ago:"ago",later:"later",justNow:"just now",soon:"soon",template:"{num} {unit} {suffix}"}},v=f[n]||f.zh,h=s(e),m=h.getTime()-Date.now(),p=Math.abs(m);if(p<o[0])return m<0?v.justNow:v.soon;if(p>=o[1])return u(h,c);var g=v.later;m<0&&(g=v.ago,m=-m);var b=Math.floor(m/1e3),y=Math.floor(b/60),w=Math.floor(y/60),_=Math.floor(w/24),k=Math.floor(_/30),x=Math.floor(k/12);switch(!0){case x>0:l=x,d=v.year;break;case k>0:l=k,d=v.month;break;case _>0:l=_,d=v.day;break;case w>0:l=w,d=v.hour;break;case y>0:l=y,d=v.minute;break;default:l=b,d=v.second;break}"en"===n&&(1===l?l="a":d+="s");return v.template.replace(/{\s*num\s*}/g,l+"").replace(/{\s*unit\s*}/g,d).replace(/{\s*suffix\s*}/g,g)};var a=n(i("53ca"));function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;e+="";while(e.length<t)e="0"+e;return e.slice(-t)}i("fb6a"),i("c975"),i("ac1f"),i("5319");var r={yyyy:function(e){return o(e.year,4)},yy:function(e){return o(e.year)},MM:function(e){return o(e.month)},M:function(e){return e.month},dd:function(e){return o(e.day)},d:function(e){return e.day},hh:function(e){return o(e.hour)},h:function(e){return e.hour},mm:function(e){return o(e.minute)},m:function(e){return e.minute},ss:function(e){return o(e.second)},s:function(e){return e.second},SSS:function(e){return o(e.millisecond,3)},S:function(e){return e.millisecond}};function s(e){if(e instanceof Date)return e;switch((0,a.default)(e)){case"string":return e.indexOf("T")>-1?new Date(e):new Date(e.replace(/-/g,"/"));default:return new Date(e)}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy/MM/dd hh:mm:ss";if(!e&&0!==e)return"";e=s(e);var i={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()},n=/yyyy|yy|MM|M|dd|d|hh|h|mm|m|ss|s|SSS|SS|S/,a=!0,o=t;while(a)a=!1,o=o.replace(n,(function(e){return a=!0,r[e](i)}));return o}},fd52:function(e,t,i){"use strict";i("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("a9e3"),i("e25e");var n=i("d6ef"),a={name:"uniDateformat",props:{date:{type:[Object,String,Number],default:function(){return"-"}},locale:{type:String,default:"zh"},threshold:{type:Array,default:function(){return[0,0]}},format:{type:String,default:"yyyy/MM/dd hh:mm:ss"},refreshRate:{type:[Number,String],default:0}},data:function(){return{refreshMark:0}},computed:{dateShow:function(){return this.refreshMark,(0,n.friendlyDate)(this.date,{locale:this.locale,threshold:this.threshold,format:this.format})}},watch:{refreshRate:{handler:function(){this.setAutoRefresh()},immediate:!0}},methods:{refresh:function(){this.refreshMark++},setAutoRefresh:function(){var e=this;clearInterval(this.refreshInterval),this.refreshRate&&(this.refreshInterval=setInterval((function(){e.refresh()}),parseInt(this.refreshRate)))}}};t.default=a}}]);